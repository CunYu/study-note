### 概述

G1收集器是为了替换CMS收集器出现的，其作用于青年代和老年代，其整体上是使用标记-整理算法。

G1收集器即保证了吞吐量也保证了GC停顿时间。

### G1收集器内存结构

<img src="./Java/JVM/image/G1收集器内存结构.png" alt="G1收集器内存结构M位置"/>

G1收集器将内存划分为若干个大小相同的Region，这些Region可以归属于垃圾回收分代中的某一代。

Region的大小可以指定，默认是将堆分为2048份。

当对象的大小超过Region一半时，其会在新的一个或连续多个Region中分配。

### 特点

* 并发与并行

* 分代收集

* 空间整合

* 可预测停顿

### 回收步骤

##### 初始标记

Initial Marking

该步骤会发生GC停顿，其标记GC Roots能直接关联的对象，并且修改TAMS（Next Top at Mark Start）的值，使接下来的用户程序在可用的Region中创建新对象，该过程耗时短。

##### 并发标记

Conourrent Marking

该步骤会和用户程序并发运行，其会从GC Roots开始，进行可达性分析。

##### 最终标记

Final Marking

该步骤会发生GC停顿，由于并发标记会和用户程序并发运行，所以该步骤是为了修正并发标记步骤期间运行导致的变动，对一些对象进行重新标记操作。

##### 筛选回收

Live Data Counting and Evacuation

该步骤先对各个Region按照回收价值和成本进行排序，然后按照用户所期望的GC停顿时间来制定回收计划，选择一些Region进行回收。