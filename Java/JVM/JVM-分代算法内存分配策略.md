### 分代算法内存结构

<img src="./Java/JVM/image/分代算法内存结构.png" alt="分代算法内存结构"/>

### 分代算法垃圾回收行为

* Minor GC

青年代垃圾回收行为，Minor GC比较频繁，回收速度较快。

采用标记-复制算法，会将Eden和From Survivor区的有效对象复制到To Survivor中并按顺序依次存放，然后清除Eden和From Survivor区并将From Survivor和To Survivor区的标识互换。

* Major GC/Full GC

老年代垃圾回收行为，其效率要比Minor GC慢很多。

### 堆内存分配

##### 青年代

大多数情况下，对象优先在Eden区分配，当Eden区内存不足时，其会发起一次Minor GC。

##### 老年代

大对象（需要大量连续内存的Java对象）会直接进入老年代。

长期存活的对象会进入老年代，青年代对象会有一个年龄计数器，每进行一次Minor GC后，如果其还存活的话，其年龄会加一，当其年龄到一定数值（默认为15）后，其会进入老年代，如果Survivor区中某一年龄的对象占用空间大于Survivor区的一半，那么大于等于该年龄的对象都可以进入老年代。

##### 空间分配担保

老年代需要为青年代作担保，如果青年代内存不足时，需要老年代来存放。

发生Minor GC之前，虚拟机会先判断老年代最大可用连续空间是否大于青年代所有对象空间，如果大于则进行Minor GC。

如果不大于而且允许担保失败，虚拟机则继续判断老年代最大可用连续空间是否大于以往每次进入老年代对象的平均空间，如果大于，则进行Minor GC.

其他情况则进行一次Full GC。