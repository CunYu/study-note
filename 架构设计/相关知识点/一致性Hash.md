### 概述

一致性Hash算法主要用在负载均衡方面，传统的Hash算法使用数据Hash值除以节点数取余的方式来确定数据位置，但当节点数发生变化时，这时之前的数据位置全部发生了变化，之前的数据位置全部失效，需要重新计算，而一致性Hash算法是为了弥补传统Hash算法负载均衡方面的不足，在节点数发生变化时，之前的数据位置只会部分实效。

### 原理

一致性Hash也是采用取余数的方法，只不过其是对2^32取余，其会形成以Hash环。

其先对节点进行处理，得到节点在Hash环上的位置，然后再对数据进行处理，得到数据在Hash环上的位置。

对于数据来说，顺着环的方向遇到的第一个节点就是其位置。

当节点发生变化时，其影响的只是部分数据，而不是全部。

<img src="./架构设计/相关知识点/image/一致性Hash.png" alt="一致性Hash"/>

### 平衡性

当节点数比较少时，其会造成数据位置不平衡，所以我们可以采用虚拟节点的方式来使数据位置分散均匀。